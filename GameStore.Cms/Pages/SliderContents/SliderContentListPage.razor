@page "/slidercontents"

@inherits BaseDataPage<ODataSliderContent>
@inject SliderContentODataService SliderContentODataService
@inject SliderContentService SliderContentService

<div class="row">
    <div class="col-xl-3">
        <RadzenButton Icon="add" Click=@(args => DialogService.Open<SliderContentAddPage>("Yeni Slider",
                      null,
                      new DialogOptions{Width = "600px"} )) />

        <RadzenButton Icon="refresh" Click=@Refresh />

        @if (SelectedItem != null)
        {
            <RadzenButton Icon="preview" Click=@(async args => await DialogService.OpenAsync<SliderContentUpdatePage>("Slider Düzenle",
                      new Dictionary<string, object> { { "SliderContentId", SelectedItem.Id } },
                      new DialogOptions{Width = "600px"} )) />
            <RadzenButton Icon="remove" Click=@Delete />
        }
    </div>
</div>



<BaseDataGrid TItem="ODataSliderContent"
              IsLoading="IsLoading"
              Data="Data"
              @bind-SelectedItem="@SelectedItem"
              LoadData="LoadData"
              Count="Count"
              Columns=@(new Dictionary<string, string>
              {
              { "SliderType.Description", "Slider Tipi" },
              { "Header", "Başlık" },
              { "IsActive", "Akitiflik" },
              { "Priority", "Öncelik Sırası" },
              }) />

@code {
    async Task LoadData(LoadDataArgs args)
    {
        IsLoading = true;
        LastArgs = args;

        var result = await SliderContentODataService.GetListAsync(new ODataRequestParams
            {
                Count = true,
                Filter = args.Filter,
                OrderBy = args.OrderBy,
                Skip = args.Skip,
                Top = args.Top,
                Expand = "SliderType"
            });

        Data = result.Value.AsODataEnumerable();
        Count = result.Count;

        StateHasChanged();
        IsLoading = false;
    }

    private async void Delete()
    {
        var isConfirm = await DialogService.Confirm("Silmek istediğinize emin misiniz?", "Uyarı", new ConfirmOptions { OkButtonText = "Evet", CancelButtonText = "Hayır" });
        if (isConfirm != true)
            return;

        IsLoading = true;

        var result = await SliderContentService.DeleteAsync(((ODataSliderContent)SelectedItem).Id);
        if (!result.IsSuccessful)
            NotificationService.Error(result.ErrorMessage);
        else
        {
            NotificationService.Success("Slider içeriği silindi.");
            DialogService.Close(true);
            Refresh();
        }
        
        IsLoading = false;
    }

    protected async override void Close(dynamic result)
    {
        if (result is bool val && val == true)
        {
            await LoadData(LastArgs);
            StateHasChanged();
        }
    }

    protected async override void Refresh()
    {
        base.Refresh();
        await LoadData(LastArgs);
        StateHasChanged();
    }
}
