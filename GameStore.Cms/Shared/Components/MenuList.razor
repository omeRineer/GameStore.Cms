@inject MenuService MenuService

<RadzenSidebar @bind-Expanded="@sidebar1Expanded">
    <RadzenPanelMenu>
        @if (menuListModel?.Menus != null && menuListModel?.Menus.Count() > 0)
        {
            @foreach (var menuItem in menuListModel.Menus.Where(f => f.ParentMenuId == null).OrderBy(o => o.Priority).ToList())
            {
                <RadzenPanelMenuItem Text="@($"{menuItem.Code} {menuItem.Title}")"
                                     Icon="@menuItem.Icon"
                                     Click=@(args=> { Navigate(menuItem); })>

                    @if (menuListModel.Menus.Any(e => e.ParentMenuId == menuItem.Id))
                    {
                        @foreach (var childMenuItem in menuListModel.Menus.Where(f => f.ParentMenuId == menuItem.Id).OrderBy(o => o.Priority).ToList())
                        {
                            <RadzenPanelMenuItem Click=@(args=> { Navigate(childMenuItem); })
                                                 Text="@($"{childMenuItem.Code} {childMenuItem.Title}")"
                                                 Icon="@childMenuItem.Icon"></RadzenPanelMenuItem>
                        }
                    }

                </RadzenPanelMenuItem>
            }
        }
    </RadzenPanelMenu>
</RadzenSidebar>

@code {
    bool sidebar1Expanded = true;
    GetMenusModel? menuListModel;

    protected async override Task OnInitializedAsync()
    {
        var user = await CurrentUserService.GetCurrentUserAsync();
        if (!user.IsAuthenticated)
            return;

        var result = await MenuService.GetSessionMenusAsync();

        if (result.Success)
            menuListModel = result.Data;

    }

    private void Navigate(GetMenus_Item menuItem)
    {
        if (!string.IsNullOrEmpty(menuItem.Path))
        {
            NavigationManager.NavigateTo(menuItem.Path);
        }
    }
}
